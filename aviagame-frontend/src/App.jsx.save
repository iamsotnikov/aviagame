import React, { useState, useEffect } from "react";
import axios from "axios"; // –ü–æ–¥–∫–ª—é—á–∞–µ–º axios –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å API

function App() {
  const [balance, setBalance] = useState(0);
  const [playerId, setPlayerId] = useState(""); // –î–æ–±–∞–≤–∏–º –ø–æ–ª–µ –¥–ª—è playerId

  // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –±–∞–ª–∞–Ω—Å–∞
  const getBalance = async () => {
    try {
      const response = await axios.get("http://localhost:3000/get_balance", {
        params: { playerId: playerId }, // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º playerId –≤ –∑–∞–ø—Ä–æ—Å–µ
      });
      setBalance(response.data.balance); // –û–±–Ω–æ–≤–ª—è–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Å –±–∞–ª–∞–Ω—Å–æ–º
    } catch (error) {
      console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –±–∞–ª–∞–Ω—Å–∞:", error);
    }
  };

  // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –∏–≥—Ä–æ–∫–∞ (–∑–¥–µ—Å—å –∏—Å–ø–æ–ª—å–∑—É–µ–º post-–∑–∞–ø—Ä–æ—Å)
  const registerPlayer = async () => {
    try {
      const response = await axios.post("http://localhost:3000/register", {
        playerId: playerId,
        telegramId: "exampleTelegramId", // –ò—Å–ø–æ–ª—å–∑—É–µ–º –≤—Ä–µ–º–µ–Ω–Ω—ã–π telegramId
      });
      console.log(response.data);
    } catch (error) {
      console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏:", error);
    }
  };

  useEffect(() => {
    if (playerId) {
      getBalance(); // –ó–∞–ø—Ä–∞—à–∏–≤–∞–µ–º –±–∞–ª–∞–Ω—Å –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ playerId
    }
  }, [playerId]); // –°–ª–µ–∂–µ–Ω–∏–µ –∑–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–µ–º playerId

  return (
    <div className="App">
      <h1>AVIAJET üöÄ</h1>
      <input
        type="text"
        value={playerId}
        onChange={(e) => setPlayerId(e.target.value)}
        placeholder="–í–≤–µ–¥–∏—Ç–µ playerId"
      />
      <button onClick={registerPlayer}>–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å –∏–≥—Ä–æ–∫–∞</button>
      <h2>–ë–∞–ª–∞–Ω—Å: {balance}‚ÇΩ</h2>
    </div>
  );
}

export default App;
